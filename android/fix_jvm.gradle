subprojects { project ->
    // Targeted Strategy
    
    // 2. Identify "Legacy" projects that fail if forced to 17 (Java stuck at 11)
    def isLegacy = (project.name == "fluttertoast" || project.name == "qr_code_scanner")

    project.tasks.withType(JavaCompile).configureEach {
        if (isLegacy) {
            // Mobile ads and others might need older Java, or if explicitly marked legacy
            sourceCompatibility = "11"
            targetCompatibility = "11"
        } else {
            // Default to 17 for everything else (Modern, standard plugins, app)
            sourceCompatibility = "17"
            targetCompatibility = "17"
        }
    }
    
    project.tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).configureEach {
        kotlinOptions {
            if (isLegacy) {
                 jvmTarget = "11"
            } else {
                 jvmTarget = "17"
            }
        }
    }
    
    println "FixJVM: ${project.name} -> Legacy: $isLegacy. Targets set accordingly."
}
